<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
  
  <title>Responsive Dashboard</title>
  <style>* {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: white;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 650px;
      height: 540px;
      background-color: #f2eee7;
      border: 3px solid #333;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 5px 5px 0px #333;
    }

    .top-bar {
      background-color: #f2eee7;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 10px;
      border-bottom: 3px solid black;
      gap: 8px;
    }

    .circle-group {
      display: flex;
      gap: 6px;
    }

    .circle {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid black;
    }

    .circle.red { background-color: #ff5f57; }
    .circle.yellow { background-color: #ffbd2e; }

    .button-group {
      display: flex;
      gap: 6px;
    }

    .button-group button {
      padding: 5px 8px;
      background: #f2eee7;
      border: 2px solid #000;
      font-family: Georgia, serif;
      font-size: 10px;
      cursor: pointer;
      box-shadow: inset -1px -1px 0 #000;
    }

    .button-group button:active {
      box-shadow: inset 1px 1px 0 #000;
    }

    .dashboard {
      display: flex;
      flex: 1;
      gap: 10px;
      padding: 10px;
      overflow: hidden;
    }

    .notes, .queue-box {
      border: 2px solid #333;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 3px 3px 0 #333;
      display: flex;
      flex-direction: column;
    }

    .notes {
      background-color: #fffbc9;
      flex: 2;
      overflow-y: auto;
    }

    .queue-box {
      background-color: #c35353;
      flex: 1;
      min-height: 100px;
      max-height: 100%;
      overflow-y: auto;
    }

    .notes h2, .queue-box h2 {
      font-size: 0.9rem;
      margin-bottom: 6px;
      border-bottom: 1px dashed #333;
      padding-bottom: 3px;
    }

    .notes label {
      font-size: 0.7rem;
      margin-bottom: 6px;
      display: block;
    }

    .notes input, .notes select, .notes textarea {
      width: 100%;
      padding: 4px;
      margin-top: 3px;
      margin-bottom: 6px;
      border: 2px solid #333;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.7rem;
    }

    .pixel-button {
      font-family: 'Courier New', monospace;
      border: 2px solid #333;
      background: none;
      padding: 6px 10px;
      font-size: 0.75rem;
      cursor: pointer;
      box-shadow: 2px 2px 0 #333;
      transition: all 0.1s ease;
    }

    .pixel-button:active {
      box-shadow: none;
      transform: translate(2px, 2px);
    }

    .queue-box ul {
      list-style: none;
      margin-top: 5px;
      padding-left: 0;
      overflow-y: auto;
    }

    .queue-box li {
      font-family: 'Times New Roman', Times, serif;
      color: white;
      margin-bottom: 4px;
      padding: 6px;
      border: 2px solid black;
      border-radius: 4px;
      font-size: 1rem;
    }

    #detailsSection {
      flex: 1;
      display: none;
      flex-direction: column;
      padding: 10px;
      gap: 10px;
    }
/* Bills Section Layout */
.bills-container {
  display: flex;
  flex-direction: column;
  padding: 20px;
  gap: 20px;
}

.token-box {
  align-self: flex-start;
  background-color: #f5851c;
  border: 2px solid #000000;
  width: 100%;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
  font-family: 'Merienda', cursive;
}

.token-box h3 {
  margin-bottom: 10px;
  font-size: 18px;
}

.token-box input {
  padding: 6px 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin-right: 10px;
  width: 200px;
}

.token-box button {
  padding: 6px 14px;
  background-color: #1a1a1a;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Courier New', monospace;
}

.bill-prescription-boxes {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.bill-box, .prescription-box {
  flex: 1;
  min-width: 250px;
  background-color: #fdfdfd;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  font-family: 'Merienda', cursive;
  border: 2px solid;
}
.bill-box{
    background-color: #ffbd2e; ;
}
.bill-box h3, .prescription-box h3 {
  border-bottom: 1px solid #000000;
  padding-bottom: 8px;
  margin-bottom: 12px;
  font-size: 18px;
  color: white
}

#billContent, #prescriptionContent {
  font-size: 15px;
  color: #ffffff;
}
.container {
  height: 540px;               /* Always fixed */
  overflow: hidden;            /* Hide extra outside this */
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

.inner-scroll {
  flex: 1;
  overflow-y: auto;            /* Only this scrolls */
  padding: 20px;
  box-sizing: border-box;
}

    .searchbar {
  background-color: #e09581;
  display: flex;
  padding: 10px;
  gap: 10px;
  font-size: 0.8rem;
  align-items: center;
  border: 2px solid black;
  border-radius: 6px;
}

.searchbar input {
  flex: 1;
  padding: 4px;
  font-family: monospace;
  border: 2px solid #000;
  border-radius: 4px;
  font-size: 0.8rem;
}

.searchbar button {
  padding: 5px 8px;
  font-size: 0.75rem;
  border: 2px solid #000;
  background-color: #f2eee7;
  cursor: pointer;
  font-family: 'Courier New', monospace;
  box-shadow: 2px 2px 0 #000;
  margin-left: auto;
}

.searchbar button:active {
  box-shadow: none;
  transform: translate(2px, 2px);
}

    .detailbox {
      flex: 1;
      border: 2px solid #000;
      border-radius: 6px;
      padding: 10px;
      background-color: #82aa77;
      font-family: monospace;
      font-size: 0.85rem;
      overflow-y: auto;
    }

   .prescription-box {
    
  flex: 1;
  padding: 16px;
  background-color: #2299de;
  border: 2px solid #000000;
  border-radius: 8px;
  font-family: Arial, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  height: 300px; /* Set a max height */
  box-sizing: border-box;
  overflow-y: auto; /* Enable scroll */
}

#prescriptionContent {
  white-space: pre-line;       /* ✅ Preserves line breaks but collapses extra spaces */
  overflow-wrap: break-word;   /* ✅ Wrap long words to next line */
  word-break: break-word;
  line-height: 1.6;     
  color:#f2eee7;       /* ✅ Adds spacing between lines */
  font-family: 'Courier New', monospace; /* ✅ Optional: clean fixed-width font like a real script */
}


@media (max-width: 768px) {
  .bill-prescription-boxes {
    flex-direction: column;
  }

  .bill-box,
  .prescription-box {
    flex: 1 1 100%;
  }
}


    @media (max-width: 420px) {
      .dashboard {
        flex-direction: column;
      }

      .notes, .queue-box {
        width: 100%;
      }

      .queue-box {
        flex: none;
        height: 150px;
        max-height: 150px;
      }

      .container {
        height: 540px;
      }

      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }

      .button-group {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
      }
    }
@media (max-width: 420px) {
  

  .bill-prescription-boxes {
    flex-direction: column;
    gap: 20px;
  }

  .bill-box,
  .prescription-box {
    width: 100%;
    height: auto; /* remove fixed height */
    overflow-y: visible;
  }

  .token-box {
    flex-direction: column;
    gap: 10px;
  }

  .token-box input,
  .token-box button {
    width: 100%;
    font-size: 16px;
  }

  #prescriptionContent {
    font-size: 14px;
    line-height: 1.5;
  }
}

</style>
</head>
<body>
  <div class="container">
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="circle-group">
        <div class="circle red"></div>
        <div class="circle yellow"></div>
      </div>
      <div class="button-group">
        <button id="dashboardBtn" class="top-button">Dashboard</button>
        <button id="detailsBtn" class="top-button">Personal Details</button>
        <button id="billsBtn" class="top-button">Bills</button>
        <button class="logout-button" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- DASHBOARD Section -->
    <div id="dashboardSection" class="dashboard">
      <form class="notes" id="patientForm">
        <h2>Patient Notes</h2>
        <label>Name: <input type="text" id="name" required /></label>
        <label>Age: <input type="number" id="age" required /></label>
        <label>Gender:
          <select id="gender">
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </label>
        <label>Date: <input type="date" id="date" required /></label>
        <label>Reason for visit: <textarea id="reason" rows="2"></textarea></label>
        <label>Phone Number: <input type="tel" id="phone" required /></label>
        <button type="submit" class="pixel-button">Done</button>
      </form>

      <div class="queue-box">
        <h2>Current Queue</h2>
        <ul id="queueList"></ul>
      </div>
    </div>

    <!-- PERSONAL DETAILS Section -->
    <div id="detailsSection">
      <div class="searchbar">
        Enter Token Number:
        <input type="number" id="searchToken" />
        <button onclick="searchToken()">Search</button>
      </div>
      <div class="detailbox" id="detailResult">Token generated Details.</div>
    </div>
<!-- BILLS Section -->
<div id="billsSection" style="display: none;">
  <div class="bills-container">
    <!-- Token Input -->
    <div class="token-box">
      <h3>Choose Token Number</h3>
      <input type="text" id="billTokenInput" placeholder="Enter Token Number">
      <button onclick="generateBill()">Generate</button>
    </div>

    <!-- Bill + Prescription -->
    <div class="bill-prescription-boxes inner-scroll">
      <div class="bill-box">
        <h3>Bill Receipt</h3>
        <div id="billContent">Enter a valid token number to generate bill.</div>
      </div>

      <div class="prescription-box">
        <h3>Prescription</h3>
        <div id="prescriptionContent">Prescription will be shown here.</div>
      </div>
    </div>
  </div>
</div>



  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBHdkTLBvBozcLE1t5E5pNC06TMKVaMILw",
    authDomain: "clinic-abc01.firebaseapp.com",
    projectId: "clinic-abc01",
    storageBucket: "clinic-abc01.appspot.com",
    messagingSenderId: "543155713970",
    appId: "1:543155713970:web:5ce466e1e9685d197b16ab"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById("patientForm");
  const queueList = document.getElementById("queueList");

  // Get latest token for a given date
  async function getNextToken(date) {
    const snapshot = await db.collection("patients")
      .where("date", "==", date)
      .orderBy("token", "desc")
      .limit(1)
      .get();

    if (!snapshot.empty) {
      return snapshot.docs[0].data().token + 1;
    } else {
      return 1;
    }
  }

  async function renderQueue() {
    queueList.innerHTML = "";

    const today = new Date().toISOString().split("T")[0];

    const snapshot = await db.collection("patients")
      .where("date", "==", today)
      .orderBy("token")
      .get();

    snapshot.forEach(doc => {
      const entry = doc.data();
      const li = document.createElement("li");
      li.textContent = `Token No. ${entry.token} - ${entry.name}`;
      queueList.appendChild(li);
    });
  }
form.addEventListener("submit", async function (e) {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const age = parseInt(document.getElementById("age").value);
  const gender = document.getElementById("gender").value;
  const date = document.getElementById("date").value;
  const reason = document.getElementById("reason").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!name || !date || !phone) {
    alert("Please fill all required fields.");
    return;
  }

  try {
    const token = await getNextToken(date);

    const patient = {
      name,
      age,
      gender,
      date,
      reason,
      phone,
      token
    };

    await db.collection("patients").add(patient);
    alert("Patient successfully added.");
    form.reset();
    renderQueue();

  } catch (err) {
    console.error("Error adding patient:", err);
    alert("Failed to submit. Check console for errors.");
  }
});
window.addEventListener('error', function (e) {
  console.error('Global Error:', e.error);
});

  async function searchToken() {
    const searchVal = parseInt(document.getElementById("searchToken").value);
    const resultBox = document.getElementById("detailResult");

    if (!searchVal) {
      resultBox.innerHTML = "Please enter a valid token number.";
      return;
    }

   const snapshot = await db.collection("patients")
  .where("token", "==", searchVal)
  .get();


    if (!snapshot.empty) {
      const match = snapshot.docs[0].data();
      resultBox.innerHTML = `
        <strong>Token:</strong> ${match.token}<br/>
        <strong>Name:</strong> ${match.name}<br/>
        <strong>Age:</strong> ${match.age}<br/>
        <strong>Gender:</strong> ${match.gender}<br/>
        <strong>Date:</strong> ${match.date}<br/>
        <strong>Reason:</strong> ${match.reason}<br/>
        <strong>Phone:</strong> ${match.phone}
      `;
    } else {
      resultBox.innerHTML = "No patient found with this token number.";
    }
  }

  // Navigation
  const dashboardBtn = document.getElementById("dashboardBtn");
  const detailsBtn = document.getElementById("detailsBtn");
  const billsBtn = document.getElementById("billsBtn");

  const dashboardSection = document.getElementById("dashboardSection");
  const detailsSection = document.getElementById("detailsSection");
  const billsSection = document.getElementById("billsSection");

  dashboardBtn.addEventListener("click", () => {
    dashboardSection.style.display = "flex";
    detailsSection.style.display = "none";
    billsSection.style.display = "none";
  });

  detailsBtn.addEventListener("click", () => {
    dashboardSection.style.display = "none";
    detailsSection.style.display = "flex";
    billsSection.style.display = "none";
  });

  billsBtn.addEventListener("click", () => {
    dashboardSection.style.display = "none";
    detailsSection.style.display = "none";
    billsSection.style.display = "flex";
  });

async function generateBill() {
  const tokenNumber = parseInt(document.getElementById("billTokenInput").value.trim());
  if (!tokenNumber) {
    alert("Please enter a valid token number.");
    return;
  }

  try {
    const snapshot = await db.collection("patients")
      .where("token", "==", tokenNumber)
      .limit(1)
      .get();

    if (snapshot.empty) {
      document.getElementById("billContent").innerText = "No patient found with this token.";
      document.getElementById("prescriptionContent").innerText = "";
      return;
    }

    const patientData = snapshot.docs[0].data();
    const billHtml = `
      <p><strong>Patient Name:</strong> ${patientData.name}</p>
      <p><strong>Age:</strong> ${patientData.age}</p>
      <p><strong>Date:</strong> ${patientData.date}</p>
      <p><strong>Token Number:</strong> ${patientData.token}</p>
      <p><strong>Consultation Fee:</strong> ₹500</p>
      <p><strong>Status:</strong> Paid</p>
    `;
    document.getElementById("billContent").innerHTML = billHtml;

    // Fetch prescription from within the patient document
    const prescriptionData = patientData.prescription;

    if (prescriptionData) {
     document.getElementById("prescriptionContent").innerHTML = `
  <pre>${prescriptionData}</pre>
`;

    } else {
      document.getElementById("prescriptionContent").innerText = "No prescription found for this token.";
    }

  } catch (error) {
    console.error("Error generating bill or fetching prescription:", error);
    document.getElementById("billContent").innerText = "Failed to generate bill.";
    document.getElementById("prescriptionContent").innerText = "Error fetching prescription.";
  }
}

  function logout() {
  alert("Logged out.");
  window.location.href = "index.html"; // Redirect to index.html
}


  renderQueue();

</script>

</body>
</html>
